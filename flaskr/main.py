from flask import Flask, render_template, Response
from json import dumps

app = Flask(__name__)

lyceum_buildings = [
    {"coordinates": [55.752318, 37.637371], "name": "–õ–∏—Ü–µ–π –Ω–∞ –°–æ–ª—è–Ω–∫–µ"},
    {"coordinates": [55.753164, 37.648106], "name": "–í—ã—à–∫–∞ –Ω–∞ –ü–æ–∫—Ä–µ"},
    {"coordinates": [55.760825, 37.652278], "name": "–õ–∏—Ü–µ–π –Ω–∞ –õ—è–ª–µ"},
    {"coordinates": [55.763528, 37.643714], "name": "–õ–∏—Ü–µ–π –Ω–∞ –ë–•"},
    {"coordinates": [55.769390, 37.618911], "name": "–õ–∏—Ü–µ–π –Ω–∞ –ö–æ–ª–æ–±–∫–µ"},
]

posts_dict = [
    {
        "name": "whaat",
        "id": 412,
        "author": "kekus",
        "place_name": "–î–∞–±–ª–±–∏",
        "body_text": """
            –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞—à—É —Ä—É–±—Ä–∏–∫—É " –ö–æ—Ñ–µ –±—Ä–µ–π–∫", –∏ –Ω–∞—à–µ —Å–ª–µ–¥—É—é—â–µ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ - –î–∞–±–ª–±–∏.‚òïÔ∏è
            –î–∞–±–ª–±–∏ - –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è —Å–µ—Ç—å –∫–æ—Ñ–µ–µ–Ωüåç –∏ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º–æ–π —Ç–∏—Ç—É–ª–æ–≤–∞–Ω–Ω–æ–π –≤ –†–æ—Å—Å–∏–∏. –í –µ–µ —Å–æ—Å—Ç–∞–≤–µ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã–µ —á–µ–º–ø–∏–æ–Ω—ã –†–æ—Å—Å–∏–∏ –ø–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—é –∫–æ—Ñ–µ, —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –∏ —Ç—Ä–µ–Ω–µ—Ä—ã, –∞ —Ç–∞–∫–∂–µ –≤–∏—Ü–µ-—á–µ–º–ø–∏–æ–Ω –º–∏—Ä–∞ –ø–æ –æ–±–∂–∞—Ä–∫–µ –∫–æ—Ñ–µ, —Ñ–∏–Ω–∞–ª–∏—Å—Ç –º–∏—Ä–æ–≤–æ–≥–æ —á–µ–º–ø–∏–æ–Ω–∞—Ç–∞ –ø–æ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—é –∫–æ—Ñ–µüèÜ. –°–µ–π—á–∞—Å –≤ —Å–µ—Ç–∏ –±–æ–ª–µ–µ 60 –∫–æ—Ñ–µ–µ–Ω.
            
            –í –º–µ–Ω—é –º—ã –≤–∏–¥–∏–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–∏–¥–æ–≤ –∫–æ—Ñ–µ, –Ω–æ –µ—Å–ª–∏ –≤—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ —á–∞–π, —Ç–æ –¥–ª—è –≤–∞—Å —Ç–æ–∂–µ —á—Ç–æ-—Ç–æ –Ω–∞–π–¥–µ—Ç—Å—è.‚ò∫Ô∏èüçµ
            
            –°–µ–π—á–∞—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç –∞–∫—Ü–∏—è –æ—Å–µ–Ω–Ω–µ-–∑–∏–º–Ω–∏—Ö –Ω–∞–ø–∏—Ç–∫–æ–≤üçÇ‚ùÑÔ∏è, –≥–¥–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –æ—á–µ–Ω—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –≤–∫—É—Å—ã –∏ –≤–∞—Ä–∏–∞—Ü–∏–∏ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã—Ö –≤–∏–¥–æ–≤ –∫–æ—Ñ–µ –∏ —á–∞—è. –ö –ø—Ä–∏–º–µ—Ä—É, –ª–∞—Ç—Ç–µ "–¶–≤–µ—Ç—É—â–∞—è –≤–∏—à–Ω—è" –∑–≤—É—á–∏—Ç –æ—á–µ–Ω—å-–æ—á–µ–Ω—å –≤–∫—É—Å–Ω–æ.üçí
            
            –ü–æ–º–∏–º–æ –Ω–∞–ø–∏—Ç–∫–æ–≤, –≤ –º–µ–Ω—é –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –±–ª—é–¥–∞: —Å–∞–ª–∞—Ç—ã –Ω–∞ –ª—é–±–æ–π –≤–∫—É—Åü•ó, —Ä–∞–∑–ª–∏—á–Ω–∞—è –≤—ã–ø–µ—á–∫–∞ü•ß –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ! –í—Å—ë —ç—Ç–æ –µ—Å—Ç—å –≤ –î–∞–±–ª–±–∏.
            
            –°–∞–º—ã–µ –±–ª–∏–∂–∞–π—à–∏–µ –∫–æ—Ñ–µ–π–Ω–∏ –∫ –∑–¥–∞–Ω–∏—è–º –ª–∏—Ü–µ—è:
            üìç–°–æ–ª—è–Ω—Å–∫–∏–π –ø–µ—Ä–µ—É–ª–æ–∫, 1 (–º. –ö–∏—Ç–∞–π –≥–æ—Ä–æ–¥)
            üìç–¶–≤–µ—Ç–Ω–æ–π –±—É–ª—å–≤–∞—Ä, 1 (–º. –¶–≤–µ—Ç–Ω–æ–π –±—É–ª—å–≤–∞—Ä)
            üìç–ú–∏–ª—é—Ç–∏–Ω—Å–∫–∏–π –ø–µ—Ä–µ—É–ª–æ–∫, 3 (–º. –ß–∏—Å—Ç—ã–µ –ø—Ä—É–¥—ã)
        """
    },
    {
        "name": "whaat",
        "id": 412,
        "author": "kekus",
    }

]

for i in posts_dict:
    if "body_text" in i:
        i["body_text"] = i["body_text"].replace("\n", "<br>")

reviews = [
    {"id": 1, "name": "Max", "rating": 3, "text": "a great place, bad food"},
    {"id": 0, "name": "Ivan", "rating": 5, "text": "impressive, very nice"},
    {"id": 1, "name": "Keril", "rating": 1, "text": "my friend died here"}
]

diners = [
    {"id": 0, "name": "Cofix", "position": [55.754005, 37.636823], "reviewed": True},
    {"id": 1, "name": "–î–∞–±–ª–±–∏", "position": [55.712390, 37.618911], "reviewed": False},
]


@app.route('/')
def index_page():
    return render_template("index.html")


@app.route('/map')
def map_page():
    return render_template("map.html")


@app.route('/blog')
def blog_page():
    return render_template("blog.html", posts=posts_dict)


@app.route("/diners")
def get_diners():
    return Response(dumps(diners, default=str), 200, mimetype='application/json')


@app.route("/lyceum_buildings")
def get_lyceum_buildings():
    return Response(dumps(lyceum_buildings, default=str), 200, mimetype='application/json')


@app.get("/official_review/<int:id>")
def get_official_review(id: int):
    if "body_text" in posts_dict[id]:
        text = posts_dict[id]["body_text"]
    else:
        text = "–ú—ã –µ—â–µ –Ω–µ –Ω–∞–ø–∏—Å–∞–ª–∏ –æ–±–∑–æ—Ä —ç—Ç–æ–≥–æ –º–µ—Å—Ç–∞"

    return f"<div class='official-review'>{text}</div>"


@app.get("/reviews/<int:id>")
def get_reviews(id: int):
    res = []
    for i in reviews:
        if i["id"] == id:
            html_review_elem = f"""<div class="review-item">
                  <span class="review-rating">{i["rating"]} ‚òÖ</span>
                  <span>{i["name"]}</span>
                  <p>{i["text"]}</p>
                </div>"""
            res.append(html_review_elem)

    if res:
        return " ".join(res)

    res = "<div class='no-reviews'>–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤, –æ—Å—Ç–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π!</div>"

    return res


if __name__ == "__main__":
    app.run(host="0.0.0.0", port=80)
